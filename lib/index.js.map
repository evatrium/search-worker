{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import greenlet from \"greenlet\";\n\nPromise.pending = Promise.race.bind(Promise, []);\n//greenlet can't reference anything outside its scope\nconst worker = greenlet(function worker([initialize, value, keys, fuzzy = 3, originalList]) {\n    if (!initialize) {\n        const {data} = worker;\n        keys = data.keys;\n        fuzzy = data.fuzzy;\n        originalList = data.originalList;\n    } else worker.data = {keys, fuzzy, originalList};\n    return new Promise(resolve => {\n        let makeFuzzy = fuzzy > 1 ? v => (v + '').toLowerCase().split('_').join('').split('-').join('').split(' ').join('') : v => v,\n            fuzzyMatch = (search, target) => new RegExp('.*' + makeFuzzy(search).split('').join('.*') + '.*').test(makeFuzzy(target)), // https://stackoverflow.com/a/55338523/5429040\n            basicSearch = (search, target) => makeFuzzy(target).search(makeFuzzy(search)) !== -1,\n            exactMatch = (search, target) => search === target,\n            searchIt = fuzzy > 2 ? fuzzyMatch : fuzzy > 0 ? basicSearch : exactMatch,\n            updatedList = originalList.filter(item =>\n                keys ? keys.some(key => item[key] && searchIt(value, item[key])) : searchIt(value, item)\n            );\n        resolve([updatedList, value]);\n    })\n});\n\nexport const SearchWorker = (_originalList, options = {}) => {\n    let originalList = [..._originalList],\n        newList = true, wasSearching = false,\n        resultsCache = {}, cancel, {keys, fuzzy} = options;\n    const workerSearch = value => {\n        wasSearching = true;\n        return new Promise(resolveIt => {\n            cancel = () => resolveIt(Promise.pending());\n            worker(newList ? [true, value, keys, fuzzy, originalList] : [false, value]).then(resolveIt);\n            newList = false;\n        })\n    };\n    return value => new Promise(resolve => {\n        wasSearching && (cancel && cancel(), wasSearching = false);\n        value.length === 0 ? resolve(originalList)\n            : resultsCache[value] ? resolve(resultsCache[value])\n            : workerSearch(value).then(([updatedList, originalSearchValue]) => {\n                resultsCache[originalSearchValue] = updatedList;\n                value === originalSearchValue && value.length !== 0 ? resolve(updatedList)\n                    : (value.length === 0) && resolve(originalList);\n            });\n    });\n};"],"names":["Promise","pending","race","bind","worker","greenlet","initialize","value","keys","fuzzy","originalList","data","resolve","makeFuzzy","v","toLowerCase","split","join","searchIt","search","target","RegExp","test","filter","item","some","key","SearchWorker","_originalList","options","cancel","newList","wasSearching","resultsCache","length","resolveIt","then","workerSearch","updatedList","originalSearchValue"],"mappings":"wBAEAA,QAAQC,QAAUD,QAAQE,KAAKC,KAAKH,QAAS,IAE7C,MAAMI,EAASC,EAAS,SAASD,GAAQE,EAAYC,EAAOC,EAAMC,EAAQ,EAAGC,IACzE,GAAKJ,EAKEF,EAAOO,KAAO,CAACH,KAAAA,EAAMC,MAAAA,EAAOC,aAAAA,OALlB,CACb,MAAMC,KAACA,GAAQP,EACfI,EAAOG,EAAKH,KACZC,EAAQE,EAAKF,MACbC,EAAeC,EAAKD,aAExB,WAAWV,QAAQY,IACf,IAAIC,EAAYJ,EAAQ,EAAIK,IAAMA,EAAI,IAAIC,cAAcC,MAAM,KAAKC,KAAK,IAAID,MAAM,KAAKC,KAAK,IAAID,MAAM,KAAKC,KAAK,IAAMH,GAAKA,EAIvHI,EAAWT,EAAQ,EAHN,CAACU,EAAQC,IAAW,IAAIC,OAAO,KAAOR,EAAUM,GAAQH,MAAM,IAAIC,KAAK,MAAQ,MAAMK,KAAKT,EAAUO,IAG7EX,EAAQ,EAF9B,CAACU,EAAQC,KAA4D,IAAjDP,EAAUO,GAAQD,OAAON,EAAUM,IACxD,CAACA,EAAQC,IAAWD,IAAWC,EAKhDR,EAAQ,CAHUF,EAAaa,OAAOC,GAC9BhB,EAAOA,EAAKiB,KAAKC,GAAOF,EAAKE,IAAQR,EAASX,EAAOiB,EAAKE,KAASR,EAASX,EAAOiB,IAErEjB,QAIjBoB,EAAe,CAACC,EAAeC,EAAU,MAClD,IAEuBC,EAFnBpB,EAAe,IAAIkB,GACnBG,GAAU,EAAMC,GAAe,EAC/BC,EAAe,IAAYzB,KAACA,EAADC,MAAOA,GAASoB,EAS/C,OAAOtB,GAAS,IAAIP,QAAQY,IACxBoB,IAAiBF,GAAUA,IAAUE,GAAe,GACnC,IAAjBzB,EAAM2B,OAAetB,EAAQF,GACvBuB,EAAa1B,GAASK,EAAQqB,EAAa1B,IAXhCA,CAAAA,IACjByB,GAAe,MACJhC,QAAQmC,IACfL,EAAS,IAAMK,EAAUnC,QAAQC,WACjCG,EAAO2B,EAAU,EAAC,EAAMxB,EAAOC,EAAMC,EAAOC,GAAgB,EAAC,EAAOH,IAAQ6B,KAAKD,GACjFJ,GAAU,KAORM,CAAa9B,GAAO6B,KAAK,EAAEE,EAAaC,MACtCN,EAAaM,GAAuBD,EACpC/B,IAAUgC,GAAwC,IAAjBhC,EAAM2B,OAAetB,EAAQ0B,GACtC,IAAjB/B,EAAM2B,QAAiBtB,EAAQF"}